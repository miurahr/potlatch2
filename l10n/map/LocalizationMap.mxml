<?xml version="1.0" encoding="utf-8"?>
<LocaleMap enableLog="false"
    xmlns:fx="http://ns.adobe.com/mxml/2009"
    xmlns:factory="mx.core.*"
    xmlns="http://l10n.babelfx.org/" >

  <!-- Support for Locale ResourceBundle changes -->
  <fx:Script>
    <![CDATA[
      import org.babelfx.commands.ExternalLocaleCommand;
      import mx.resources.ResourceManager;
      import mx.resources.IResourceManager;

      import net.systemeD.potlatch2.help.HelpDialog;
      import net.systemeD.potlatch2.TagViewer;
      import net.systemeD.potlatch2.Toolbox;

      private function onLocaleChanged(event:Event):void {
          var rMngr : IResourceManager = ResourceManager.getInstance();
          var ri : ResourceInjector = event.target as ResourceInjector;
          var options : Array = [
                                  { label : rMngr.getString('p2_main','main.gps_data') },
                                  { label : rMngr.getString('p2_main','main.my_tracks') },
                                  { label : rMngr.getString('p2_main','main.clear_gps') }
                                ];

          // Iterate all view instances and inject new dataProvider
          for each (var inst:potlatch2 in ri.targetInstances) {
              if (inst == null) continue;
              inst.gpsButton.dataProvider = options;
          }
      }
    ]]>
  </fx:Script>

  <commandFactory>
    <factory:ClassFactory generator="{ExternalLocaleCommand}">
      <factory:properties>
        <fx:Object externalPath="locales/\{0\}.swf"/>
      </factory:properties>
    </factory:ClassFactory>
  </commandFactory>

  <!--
  ResourceInjectors for targeted class instantiations. Instead of dependency injection of UI instances,
  we use RI(s) here to remove any need to know view hierarchy relationships... we simply want a reference
  to the UI instance when ready.
  -->

  <ResourceInjector bundleName="help_dialog" target="{HelpDialog}">
    <ResourceSetter property="gettingStarted.text" key="help.gettingStarted" />
    <ResourceSetter property="welcome.label" key="help.welcome" />
  </ResourceInjector>

  <ResourceInjector bundleName="p2_main" target="{potlatch2}" localeChange="onLocaleChanged(event)">
    <ResourceSetter property="bgButton.label" key="main.background" />
    <ResourceSetter property="styleButton.label" key="main.map_style" />
    <ResourceSetter property="undo.label" key="main.undo" />
    <ResourceSetter property="redo.label" key="main.redo" />
    <ResourceSetter property="helpButton.label" key="main.help" />
    <ResourceSetter property="optionsButton.label" key="main.options" />
    <ResourceSetter property="saveButton.label" key="main.save" />
  </ResourceInjector>

  <ResourceInjector bundleName="p2_main" target="{TagViewer}">
    <ResourceSetter property="dndPrompt" key="tag_viewer.dndprompt" />
  </ResourceInjector>

  <ResourceInjector bundleName="p2_main" target="{Toolbox}">
    <ResourceSetter property="deleteNode" key="toolbox.delete_node" />
    <ResourceSetter property="deleteWay" key="toolbox.delete_way" />
    <ResourceSetter property="deleteArea" key="toolbox.delete_area" />
    <ResourceSetter property="deleteItem" key="toolbox.delete_item" />
    <ResourceSetter property="reverseButton.toolTip" key="toolbox.reverse_direction" />
    <ResourceSetter property="splitButton.toolTip" key="toolbox.split_way" />
    <ResourceSetter property="mergeButton.toolTip" key="toolbox.merge_ways" />
    <ResourceSetter property="straightenButton.toolTip" key="toolbox.straighten_way" />
    <ResourceSetter property="circulariseButton.toolTip" key="toolbox.make_circular" />
    <ResourceSetter property="quadrilateraliseButton.toolTip" key="toolbox.make_right_angled" />
    <ResourceSetter property="parralleliseButton.toolTip" key="toolbox.create_parrallel_way" />
  </ResourceInjector>

</LocaleMap>